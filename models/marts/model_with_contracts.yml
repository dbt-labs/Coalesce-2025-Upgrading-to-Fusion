version: 2

models:
  - name: customer_analytics_with_contracts
    description: "Customer analytics with enhanced data contracts"
    
    # Model contracts for data quality enforcement
    access: protected
    contract:
      enforced: true
      
    constraints:
      - type: not_null
        columns: [customer_id, email]
      - type: unique
        columns: [customer_id]
      - type: check
        expression: "customer_id > 0"
      - type: check  
        expression: "lifetime_value >= 0"
      - type: foreign_key
        columns: [customer_id]
        references:
          to: ref('customers')
          columns: [customer_id]
    
    columns:
      - name: customer_id
        description: "Unique customer identifier"
        data_type: varchar
        constraints:
          - type: not_null
          - type: unique
        tests:
          - not_null
          - unique
          
      - name: email
        description: "Customer email address"
        data_type: varchar(255)
        constraints:
          - type: not_null
        tests:
          - not_null
          - dbt_utils.not_empty_string
              
      - name: first_name
        description: "Customer first name"
        data_type: varchar(100)
        
      - name: last_name  
        description: "Customer last name"
        data_type: varchar(100)
        
      - name: lifetime_value
        description: "Customer lifetime value in USD"
        data_type: decimal(10,2)
        constraints:
          - type: check
            expression: "lifetime_value >= 0"
        tests:
          - dbt_utils.accepted_range:
              min_value: 0
              max_value: 1000000
              
      - name: customer_tier
        description: "Customer tier based on spending"
        data_type: varchar(20)
        constraints:
          - type: check
            expression: "customer_tier IN ('BRONZE', 'SILVER', 'GOLD', 'PLATINUM')"
        tests:
          - accepted_values:
              values: ['BRONZE', 'SILVER', 'GOLD', 'PLATINUM']
              
      - name: last_ordered_at
        description: "Date of customer's most recent order"
        data_type: timestamp_ntz
        
      - name: total_orders
        description: "Total number of orders placed by customer"
        data_type: integer
        constraints:
          - type: check
            expression: "total_orders >= 0"

  - name: financial_reporting_protected
    description: "Financial reporting with enhanced governance"
    
    # Protected model access for data security
    access: private
    group: finance
    
    # Deprecation warning - another type of migration consideration
    deprecation_date: '2024-08-01'
    
    contract:
      enforced: true
      
    # Model-level constraints
    constraints:
      - type: check
        expression: "revenue_amount IS NOT NULL"
      - type: check
        expression: "revenue_amount >= 0"
        
    columns:
      - name: order_id
        description: "Order identifier"
        data_type: varchar
        constraints:
          - type: not_null
          - type: unique
          
      - name: revenue_amount
        description: "Revenue amount in USD"
        data_type: decimal(15,2)
        constraints:
          - type: not_null
          - type: check
            expression: "revenue_amount >= 0"
            
      - name: ordered_at
        description: "Order date"
        data_type: timestamp_ntz
        constraints:
          - type: not_null
          
      - name: customer_id
        description: "Customer identifier"  
        data_type: varchar
        constraints:
          - type: not_null
        tests:
          - relationships:
              to: ref('customers')
              field: customer_id

groups:
  - name: finance
    owner:
      name: "Finance Team"
      email: "finance@company.com"
      
  - name: analytics  
    owner:
      name: "Analytics Team"
      email: "analytics@company.com"
